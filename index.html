<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live News App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Enable Tailwind dark mode via class
    tailwind.config = { darkMode: 'class' }
  </script>
</head>
<body class="bg-gray-100 text-gray-900 transition-colors" id="body">
  <div class="max-w-6xl mx-auto p-6">
    <div class="flex items-center justify-between mb-4">
      <h1 class="text-3xl font-bold">ðŸ“° Live News</h1>
      <button id="themeToggle" class="px-3 py-2 rounded bg-gray-800 text-white dark:bg-gray-200 dark:text-gray-900">Toggle Dark Mode</button>
    </div>

    <!-- Controls -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <input id="query" type="text" placeholder="Search news (e.g. technology, sports)" class="w-full p-2 rounded border dark:bg-gray-800 dark:text-white" />
      <select id="category" class="w-full p-2 rounded border dark:bg-gray-800 dark:text-white">
        <option value="">All Categories</option>
        <option value="business">Business</option>
        <option value="technology">Technology</option>
        <option value="sports">Sports</option>
        <option value="entertainment">Entertainment</option>
        <option value="health">Health</option>
        <option value="science">Science</option>
      </select>
      <button onclick="fetchNews()" class="bg-blue-600 text-white px-4 py-2 rounded">Search</button>
    </div>

    <!-- Category Quick Filters -->
    <div class="flex flex-wrap gap-2 mb-6">
      <button onclick="setCategory('')" class="filter-btn">All</button>
      <button onclick="setCategory('business')" class="filter-btn">Business</button>
      <button onclick="setCategory('technology')" class="filter-btn">Technology</button>
      <button onclick="setCategory('sports')" class="filter-btn">Sports</button>
      <button onclick="setCategory('entertainment')" class="filter-btn">Entertainment</button>
      <button onclick="setCategory('health')" class="filter-btn">Health</button>
      <button onclick="setCategory('science')" class="filter-btn">Science</button>
    </div>

    <div id="newsContainer" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
  </div>

  <style>
    .filter-btn { @apply px-3 py-1 rounded border bg-white text-gray-800 dark:bg-gray-800 dark:text-white; }
  </style>

  <script>
    const API_KEY = "e6c65d8f3e6140498c3a86e4cd8916c3";

    // Theme handling
    const body = document.getElementById('body');
    const toggle = document.getElementById('themeToggle');
    if (localStorage.getItem('theme') === 'dark') body.classList.add('dark');
    toggle.addEventListener('click', () => {
      body.classList.toggle('dark');
      localStorage.setItem('theme', body.classList.contains('dark') ? 'dark' : 'light');
    });

    function setCategory(cat) {
      document.getElementById('category').value = cat;
      fetchNews();
    }

    async function fetchNews() {
      const query = document.getElementById("query").value;
      const category = document.getElementById("category").value;

      let url = '';
      if (category) {
        // Use top-headlines endpoint for categories
        url = `https://newsapi.org/v2/top-headlines?category=${category}&language=en&apiKey=${API_KEY}`;
      } else {
        // Fallback to everything with optional search
        const q = query || 'latest';
        url = `https://newsapi.org/v2/everything?q=${q}&sortBy=publishedAt&language=en&apiKey=${API_KEY}`;
      }

      try {
        const response = await fetch(url);
        const data = await response.json();
        displayNews(data.articles);
      } catch (error) {
        console.error("Error fetching news:", error);
      }
    }

    function displayNews(articles) {
      const container = document.getElementById("newsContainer");
      container.innerHTML = "";

      if (!articles || articles.length === 0) {
        container.innerHTML = "<p>No news found.</p>";
        return;
      }

      articles.forEach(article => {
        const card = document.createElement("div");
        card.className = "bg-white p-4 rounded shadow dark:bg-gray-800 dark:text-white";

        card.innerHTML = `
          <img src="${article.urlToImage || 'https://via.placeholder.com/300'}" class="w-full h-40 object-cover rounded mb-2" />
          <h2 class="text-lg font-semibold mb-1">${article.title}</h2>
          <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">${article.description || ''}</p>
          <a href="${article.url}" target="_blank" class="text-blue-600 dark:text-blue-400 text-sm">Read more â†’</a>
        `;

        container.appendChild(card);
      });
    }

    // Load on start
    fetchNews();
  </script>
</body>
</html>
